<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Structural alignment · MolSimToolkit.jl</title><meta name="title" content="Structural alignment · MolSimToolkit.jl"/><meta property="og:title" content="Structural alignment · MolSimToolkit.jl"/><meta property="twitter:title" content="Structural alignment · MolSimToolkit.jl"/><meta name="description" content="Documentation for MolSimToolkit.jl."/><meta property="og:description" content="Documentation for MolSimToolkit.jl."/><meta property="twitter:description" content="Documentation for MolSimToolkit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="MolSimToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MolSimToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Structural analyses</span><ul><li><a class="tocitem" href="../Structural_properties/">Distances and misc.</a></li><li><a class="tocitem" href="../Dihedrals/">Dihedral angle analysis</a></li><li><a class="tocitem" href="../secondary_structures/">Secondary structure</a></li><li class="is-active"><a class="tocitem" href>Structural alignment</a><ul class="internal"><li><a class="tocitem" href="#Conventional-rigid-body-alignment"><span>Conventional rigid-body alignment</span></a></li><li><a class="tocitem" href="#Robust-rigid-body-alignment"><span>Robust rigid-body alignment</span></a></li></ul></li></ul></li><li><span class="tocitem">Simulation statistics</span><ul><li><a class="tocitem" href="../block_averages/">Block averages</a></li><li><a class="tocitem" href="../remd/">Replica exchange</a></li></ul></li><li><span class="tocitem">Interactions</span><ul><li><a class="tocitem" href="../Solvation_and_interactions/">Coordination numbers</a></li><li><a class="tocitem" href="../molecular_minimum_distances/">Molecular Minimum Distances</a></li></ul></li><li><span class="tocitem">Time-dependent properties</span><ul><li><a class="tocitem" href="../intermittent_correlation/">Intermittent correlation</a></li></ul></li><li><a class="tocitem" href="../system_setup/">System setup</a></li><li><a class="tocitem" href="../plotting_style/">Plotting style</a></li><li><a class="tocitem" href="../Developer/">Developer zone</a></li><li><span class="tocitem">Experimental</span><ul><li><a class="tocitem" href="../Reweighting/">Simulation Reweighting</a></li><li><a class="tocitem" href="../Coaraci/">Cluster submission management</a></li><li><a class="tocitem" href="../mvalues/">m-value calculator</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Structural analyses</a></li><li class="is-active"><a href>Structural alignment</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Structural alignment</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/m3g/MolSimToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/m3g/MolSimToolkit.jl/blob/main/docs/src/structural_alignment.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Structural-alignment"><a class="docs-heading-anchor" href="#Structural-alignment">Structural alignment</a><a id="Structural-alignment-1"></a><a class="docs-heading-anchor-permalink" href="#Structural-alignment" title="Permalink"></a></h1><p>MolSimToolkit.jl provides tools to perform rigid-body structural alignment throughout  trajectories.</p><p>Two types of alignments are avaialble: the &quot;standard&quot; rigid-body alignment, frequently used to compute RMSDs and RMSFs in MD trajectories, and a <strong>robust</strong> structural alignment method, <code>mdlovofit</code>. The robust alignment method provides better alignments of the rigid (or core) fractions of the structures, while magnifying the variability of the flexibile regions.</p><h2 id="Conventional-rigid-body-alignment"><a class="docs-heading-anchor" href="#Conventional-rigid-body-alignment">Conventional rigid-body alignment</a><a id="Conventional-rigid-body-alignment-1"></a><a class="docs-heading-anchor-permalink" href="#Conventional-rigid-body-alignment" title="Permalink"></a></h2><p>Conventional rigid-body aligments routines are:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkitShared.rmsd" href="#MolSimToolkitShared.rmsd"><code>MolSimToolkitShared.rmsd</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rmsd(simulation::Simulation, indices::AbstractVector{&lt;:Integer}; mass = nothing, reference_frame = nothing, show_progress = true)</code></pre><p>Computes the root mean square deviation (RMSD) between two sets of points in along a trajectory.</p><p><strong>Arguments</strong></p><ul><li><code>indices</code> vector contains the indices of the atoms to be considered. </li><li><code>mass</code> argument can be used to provide the mass of the atoms if they are not the same.</li><li><code>reference_frame</code> argument can be used to provide a reference frame to align the trajectory to:<ul><li>If <code>reference_frame == nothing</code>, the first frame will be used (default behavior).</li><li>If <code>reference_frame == :average</code>, the average structure will be used.</li><li>If <code>reference_frame</code> is an integer, the frame at that index will be used as reference.</li></ul></li></ul><p><strong>Examples</strong></p><p><strong>Computing the rmsd along a trajectory</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit, MolSimToolkit.Testing

julia&gt; using PDBTools

julia&gt; atoms = readPDB(Testing.namd_pdb);

julia&gt; simulation = Simulation(Testing.namd_pdb, Testing.namd_traj);

julia&gt; cas = findall(sel&quot;name CA&quot;, atoms); # CA indices

julia&gt; rmsd(simulation, cas; show_progress=false)
5-element Vector{Float64}:
 0.0
 2.8388710154609034
 2.9776998440690385
 2.4621444212469483
 3.8035683196100796

julia&gt; rmsd(simulation, cas; reference_frame=:average, show_progress=false)
5-element Vector{Float64}:
 1.8995986972454748
 2.1512244220536973
 1.5081703191869376
 1.1651111324544219
 2.757039151265317</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/standard.jl#L1-L47">source</a></section><section><div><pre><code class="language-julia hljs">rmsd(x::AbstractVector,y::AbstractVector)</code></pre><p>Calculate the root mean square deviation between two vectors of coordinates.</p><p><strong>Arguments</strong></p><ul><li><code>x::AbstractVector</code>: A vector of coordinates.</li><li><code>y::AbstractVector</code>: A vector of coordinates.</li></ul><p><strong>Returns</strong></p><ul><li><code>rmsd::Real</code>: The root mean square deviation between the two vectors.</li></ul><pre><code class="language-julia-repl hljs">julia&gt; import MolSimToolkitShared: rmsd

julia&gt; x = [ [1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0] ];

julia&gt; y = [ [2.0, 3.0, 4.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0] ];

julia&gt; rmsd(x, y)
1.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkitShared.jl/blob/v1.1.3/src/structural_alignment.jl#L38-L63">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.rmsd_matrix" href="#MolSimToolkit.rmsd_matrix"><code>MolSimToolkit.rmsd_matrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rmsd_matrix(
    simulation::Simulation, 
    indices::AbstractVector{&lt;:Integer}; 
    mass::Union{AbstractVector{&lt;:Integer}, Nothing} = nothing,
    align::Bool = true,
    show_progress = true,
)</code></pre><p>Computes the RMSD matrix for a set of atoms along a trajectory.</p><p>The <code>indices</code> vector contains the indices of the atoms to be considered.  The <code>mass</code> argument can be used to provide the mass of the atoms if they are not the same. The <code>align</code> argument can be used to align the frames before computing the RMSD.</p><p>The <code>show_progress</code> argument can be used to show a progress bar.</p><p><strong>Returns</strong></p><p>A symetric matrix with the RMSD values between each pair of frames. For example, in  a trajectory with 5 frames, the matrix will be a 5x5 matrix with the RMSD values between the structures of each pair of frames.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit, MolSimToolkit.Testing

julia&gt; using PDBTools

julia&gt; atoms = readPDB(Testing.namd_pdb);

julia&gt; cas = findall(Select(&quot;name CA&quot;), atoms); # CA indices

julia&gt; simulation = Simulation(Testing.namd_pdb, Testing.namd_traj);

julia&gt; rmsd_matrix(simulation, cas; show_progress=false)
5×5 Matrix{Float64}:
 0.0      2.83887  2.9777   2.46214  3.80357
 2.83887  0.0      2.35492  2.64463  4.68028
 2.9777   2.35492  0.0      2.08246  3.46149
 2.46214  2.64463  2.08246  0.0      2.97835
 3.80357  4.68028  3.46149  2.97835  0.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/standard.jl#L170-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkitShared.center_of_mass" href="#MolSimToolkitShared.center_of_mass"><code>MolSimToolkitShared.center_of_mass</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">center_of_mass(
    indices::AbstractVector{Int};
    simulation::Simulation,
    positions::FramePositions,
    iref::Union{Nothing,Int} = max(1, div(length(indices),2)),
)</code></pre><p>Calculate the center of mass of a selection of atoms in a simulation given the positions. The selection is defined by the <code>indices</code> vector, which is the indices of the atoms.</p><p>The <code>iref</code> parameter is the index of the reference atom. The center of mass is calculated by first computing the minimum-image of all atoms relative to this atom. By default, it is the atom closest to the middle of the indices vector. If <code>iref</code> is <code>nothing</code>, the center of mass is calculated without wrapping the coordinates.</p><pre><code class="language-julia-repl hljs">julia&gt; using PDBTools 

julia&gt; using MolSimToolkit, MolSimToolkit.Testing

julia&gt; simulation = Simulation(Testing.namd_pdb, Testing.namd_traj);

julia&gt; protein_indices = findall(sel&quot;protein&quot;, atoms(simulation));

julia&gt; first_frame!(simulation); # move simulation to the first frame

julia&gt; coor = positions(current_frame(simulation));

julia&gt; cm = center_of_mass(protein_indices, simulation, coor)
3-element Point3D{Float64} with indices SOneTo(3):
 -3.7290442807974906
 -1.5339226637687564
  1.960640754560446</code></pre><div class="admonition is-compat" id="Compat-98b01395a05b9ae0"><header class="admonition-header">Compat<a class="admonition-anchor" href="#Compat-98b01395a05b9ae0" title="Permalink"></a></header><div class="admonition-body"><p>The <code>iref=nothing</code> option was added in version 1.22.0.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/miscelaneous_functions/center_of_mass.jl#L1-L40">source</a></section><section><div><pre><code class="language-julia hljs">center_of_mass(x::AbstractVector{&lt;:AbstractVector}[, mass::AbstractVector=nothing])</code></pre><p>Calculate the center of mass of a set of points.</p><p><strong>Arguments</strong></p><ul><li><code>x::AbstractVector{&lt;:AbstractVector}</code>: A vector of coordinates.</li><li><code>mass::AbstractVector</code>: A vector of masses. If not provided, all masses are assumed to be equal.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; import MolSimToolkitShared: center_of_mass

julia&gt; x = [ [1.0, 2.0, 3.0], [4.0, 5.0, 6.0], [7.0, 8.0, 9.0] ];

julia&gt; center_of_mass(x)
3-element Vector{Float64}:
 4.0
 5.0
 6.0

julia&gt; center_of_mass(x, [1.0, 2.0, 3.0]) # providing masses
3-element Vector{Float64}:
 5.0
 6.0
 7.0
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkitShared.jl/blob/v1.1.3/src/structural_alignment.jl#L1-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkitShared.align" href="#MolSimToolkitShared.align"><code>MolSimToolkitShared.align</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">align(x, y; mass = nothing)
align!(x, y; mass = nothing)</code></pre><p>Aligns two structures (sets of points in 3D space). Solves the &quot;Procrustes&quot; problem, which is to find the best translation, and rotation, that aligns the two structures, minimizing the RMSD between them.</p><p>Structures are expected to be of the same size, and the  correspondence is assumed from the vector indices. </p><p><code>align</code> returns a new vector containing the coordinates of x aligned to y.  <code>align!</code> modifies the input vector <code>x</code> in place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkitShared.jl/blob/v1.1.3/src/structural_alignment.jl#L72-L87">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkitShared.align!" href="#MolSimToolkitShared.align!"><code>MolSimToolkitShared.align!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">align(x, y; mass = nothing)
align!(x, y; mass = nothing)</code></pre><p>Aligns two structures (sets of points in 3D space). Solves the &quot;Procrustes&quot; problem, which is to find the best translation, and rotation, that aligns the two structures, minimizing the RMSD between them.</p><p>Structures are expected to be of the same size, and the  correspondence is assumed from the vector indices. </p><p><code>align</code> returns a new vector containing the coordinates of x aligned to y.  <code>align!</code> modifies the input vector <code>x</code> in place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkitShared.jl/blob/v1.1.3/src/structural_alignment.jl#L89">source</a></section></article><h2 id="Robust-rigid-body-alignment"><a class="docs-heading-anchor" href="#Robust-rigid-body-alignment">Robust rigid-body alignment</a><a id="Robust-rigid-body-alignment-1"></a><a class="docs-heading-anchor-permalink" href="#Robust-rigid-body-alignment" title="Permalink"></a></h2><p>MDLovoFit is a package for the analysis of the mobility and structural fluctuation in Molecular Dynamics simulations. It allows the automatic identification of rigid and mobile regions of protein structures.</p><p>For example, it is possible to automatically identifiy a stable region of a protein in simulation in which the protein displays high structural flexibility, as illustrated in the example. The regions of low mobility are automatically detected by the method.</p><p>The software provides, as output, the Root-Mean-Square Deviations of the conserved structures, and of the divergent structures. A trajectory PDB file is output for the visualization of the results. </p><p>The execution of the MDLovoFit procedure typically has three steps:</p><ul><li><a href="#mdlovofit1">Step1:</a> Identify the length of the structure that can be aligned with a precision lower than a threshold. This is done with the <code>map_fractions</code> function.</li><li><a href="#mdlovofit2">Step 2:</a> Align the trajectory for the fraction of atoms desired, with the <code>mdlovofit</code> function.</li><li><a href="#mdlovofit3">Step 3:</a> Visualize the aligned trajectory and aligned atoms.</li></ul><div class="admonition is-info" id="Note-8a35728807b315bb"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-8a35728807b315bb" title="Permalink"></a></header><div class="admonition-body"><p>Please cite the following references if these functions were useful:</p><p>L. Martínez, <strong>Automatic identification of mobile and rigid substructures in molecular dynamics simulations and fractional structural fluctuation analysis.</strong> PLoS One 10(3): e0119264, 2015.   <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0119264">Full text</a>.</p><p>L. Martínez. R. Andreani, J. M. Martínez. <strong>Convergent Algorithms for Protein Structural Alignment.</strong> BMC Bioinformatics, 8, 306, 2007. <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-8-306">Full text</a>.</p><p>It is possible to use <code>mdlovofit</code> as a standalone program by downloading it <a href="https://m3g.github.io/mdlovofit/">here</a>.</p></div></div><h3 id="mdlovofit1"><a class="docs-heading-anchor" href="#mdlovofit1">Step 1: Map fractions of aligned atoms and overlap precision</a><a id="mdlovofit1-1"></a><a class="docs-heading-anchor-permalink" href="#mdlovofit1" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.map_fractions" href="#MolSimToolkit.map_fractions"><code>MolSimToolkit.map_fractions</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">map_fractions(simulation::Simulation; maxframes=nothing)</code></pre><p>Run MDLovoFit on a trajectory, to obtain the RMSD of the fractions of the structure with the lowest RMSD, the fraction with the highest RMSD, and the whole structure.</p><p>Only CA atoms of protein residues are considered. </p><p>Argument:</p><ul><li><code>simulation</code> is a Simulation object, with the trajectory of the system and the atom data.</li></ul><p>Keyword arguments:</p><ul><li><code>maxframes=nothing</code> is the number of frames to be considered. If nothing, 100 frames are considered.   Set to <code>length(simulation)</code> to consider all frames. </li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit, MolSimToolkit.Testing

julia&gt; sim = Simulation(Testing.namd_pdb, Testing.namd_traj);

julia&gt; mf = map_fractions(sim)
-------------------------------------------------------------------
MapFractionsResult: Simulation(structure.pdb, trajectory.dcd)

-------------------------------------------------------------------
Fields: 
- fraction: fraction of atoms considered in the alignment.
- frame_indices: the frame index of each frame considered.
- rmsd_low: RMSD of the fraction of the structure with the lowest RMSD.
- rmsd_high: RMSD of the fraction not considered for the alignment.
- rmsd_all: RMSD of the whole structure.

Greatest fraction for which the RMSD-low is smaller than 1.0: 0.79
                                                         2.0: 0.9
                                                         3.0: 0.99
-------------------------------------------------------------------</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/mdlovofit.jl#L126-L168">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.MapFractionsResult" href="#MolSimToolkit.MapFractionsResult"><code>MolSimToolkit.MapFractionsResult</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MapFractionsResult</code></pre><p>Data structure to store the output of the <code>map_fractions</code> function.</p><p>Fields:</p><ul><li><code>simulation</code> is a Simulation object with the trajectory of the system and the atom data.</li><li><code>frame_indices</code> contains the frame index of each frame considered.</li><li><code>fraction</code> contains the fraction of atoms considered in the alignment.</li><li><code>rmsd_low</code> contains the RMSD of the fraction of the structure with the lowest RMSD.</li><li><code>rmsd_high</code> contains the RMSD of the fraction not considered for the alignment.</li><li><code>rmsd_all</code> contains the RMSD of the whole structure.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/mdlovofit.jl#L80-L94">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RecipesBase.plot-Tuple{MapFractionsResult}" href="#RecipesBase.plot-Tuple{MapFractionsResult}"><code>RecipesBase.plot</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">plot(mf::MapFractionsResult; xlabel=&quot;fraction of aligned residues&quot;, ylabel=&quot;RMSD&quot;, kargs...)</code></pre><p>Plot the results of a map fractions calculation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/ext/MDLovoFit.jl#L5-L10">source</a></section></article><p>The <code>map_fractions</code> function scans the trajectory and tries to align the C<span>$\alpha$</span> atoms of the protein structures, but considering only a fraction of the atoms for the alignment. The alignment is performed such that only the fraction of atoms of smaller displacements interfere with the overlap. Three RMSDs are then obtained: the RMSD of the best aligned atoms, the RMSD of the remaining (highly mobile) atoms, and the RMSD of all atoms. For example:</p><pre><code class="language-julia hljs">using MolSimToolkit, MolSimToolkit.Testing

# Create Simulation object from pdb and trajectory file names
sim = Simulation(Testing.namd_pdb, Testing.namd_traj)

# Run map_fractions
mf = map_fractions(sim)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-------------------------------------------------------------------
MapFractionsResult: Simulation(structure.pdb, trajectory.dcd)

-------------------------------------------------------------------
Fields: 
- fraction: fraction of atoms considered in the alignment.
- frame_indices: the frame index of each frame considered.
- rmsd_low: RMSD of the fraction of the structure with the lowest RMSD.
- rmsd_high: RMSD of the fraction not considered for the alignment.
- rmsd_all: RMSD of the whole structure.

Greatest fraction for which the RMSD-low is smaller than 1.0: 0.79
                                                         2.0: 0.9
                                                         3.0: 0.99
-------------------------------------------------------------------</code></pre><p>In the above run, we can readily see that 79% of the atoms of the structure can be aligned with RMSD smaller than 1.0Å. The RMSDs of the low and high mobility, and  all-C<span>$\alpha$</span> RMSDs are available as the fields of the <code>mf</code> object generated. </p><p>A convenience recipe can plot the results:</p><pre><code class="language-julia hljs">using Plots
plot(mf)</code></pre><img src="0e80079d.svg" alt="Example block output"/><p>Where we see that about 80% of atoms can be aligned to less than 1.0Å RMSD, while at the same time the 20% more flexible atoms will display an RMSD of about 7Å.</p><p>We will now consider that, in this case, 1.0Å is a good threshold for defining the  conserved structural core of the protein, and proceed with the next analysis, where we will ask <code>mdlovofit</code> to obtain the best alignment of 80% of the atoms, of each frame relative to the first frame.</p><h3 id="mdlovofit2"><a class="docs-heading-anchor" href="#mdlovofit2">Step 2: Align the trajectory for a given fraction of atoms</a><a id="mdlovofit2-1"></a><a class="docs-heading-anchor-permalink" href="#mdlovofit2" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.mdlovofit" href="#MolSimToolkit.mdlovofit"><code>MolSimToolkit.mdlovofit</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mdlovofit(
    simulation::Simulation; 
    fraction::AbstractFloat, 
    output_name::Union{String,Nothing} = nothing, 
    reference_frame::Int = 1, 
    maxframes=nothing
)</code></pre><p>Run MDLovoFit on a trajectory, aligning only the atoms which are in the fraction of the structure with the lowest RMSD. Only CA atoms of protein residues are considered.</p><p>Arguments:</p><ul><li><code>simulation</code> is a Simulation object, with the trajectory of the system and the atom data.</li><li><code>fraction</code> is the fraction of atoms to be considered in the alignment.</li></ul><p>Optional arguments:</p><ul><li><code>output_name=nothing</code> is the base name of the output files. If nothing, default names will be used.</li><li><code>reference_frame=1</code> is the index of the frame to be used as reference for the alignment.</li><li><code>maxframes=nothing</code> is the number of frames to be considered. If nothing, 100 frames are considered.   Set to <code>length(simulation)</code> to consider all frames.</li></ul><p>Output: </p><ul><li><code>MDLovoFitResult</code> data structure with the results of the alignment.</li></ul><p>and the output files:</p><ul><li><code>output_name_rmsf.dat</code> with the RMSF data.</li><li><code>output_name_rmsd.dat</code> with the RMSD data.</li><li><code>output_name_aligned.pdb</code> with the aligned structure.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit, MolSimToolkit.Testing

julia&gt; sim = Simulation(Testing.namd_pdb, Testing.namd_traj);

julia&gt; md = mdlovofit(sim, fraction=0.7, output_name=&quot;mdlovofit_50&quot;)
-------------------------------------------------------------------
MDLovoFitResult: Simulation(structure.pdb, trajectory.dcd)

-------------------------------------------------------------------

Aligned pdb file: mdlovofit_50_aligned.pdb
RMSF data file: mdlovofit_50_rmsf.dat
RMSD data file: mdlovofit_50_rmsd.dat

Number of frames considered: 5
Average RMSD of all atoms: 1.79
Average RMSD of the 70.0% atoms of lowest RMSD: 0.53
Average RMSD of the 30.0% atoms of highest RMSD: 4.71

Frame indices availabe in field: frame_indices
RMSD data availabe in fields: rmsd_low, rmsd_high, and rmsd_all

RMSF data availabe in field: rmsf (Number of atoms: 43)
-------------------------------------------------------------------</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/mdlovofit.jl#L251-L313">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.MDLovoFitResult" href="#MolSimToolkit.MDLovoFitResult"><code>MolSimToolkit.MDLovoFitResult</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MDLovoFitResult</code></pre><p>Data structure to store the output of the <code>mdlovofit</code> function.</p><p>Fields: </p><ul><li><code>simulation</code>: Simulation object with the trajectory of the system and the atom data. </li><li><code>frame_indices</code>: vector with the frame index of each frame.</li><li><code>rmsd_low</code>: RMSD of the fraction of the structure with the lowest RMSD.</li><li><code>rmsd_high</code>: RMSD of the fraction of the structure with the highest RMSD.</li><li><code>rmsd_all</code>: RMSD of the whole structure.</li><li><code>rmsf</code>: RMSF as a function of the residue or atom index. </li><li><code>rmsf_file</code>: name of the file with the RMSF data.</li><li><code>rmsd_file</code>: name of the file with the RMSD data.</li><li><code>aligned_pdb</code>: name of the PDB file with the aligned structure.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/src/structural_alignment/mdlovofit.jl#L189-L206">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="RecipesBase.plot-Tuple{MDLovoFitResult}" href="#RecipesBase.plot-Tuple{MDLovoFitResult}"><code>RecipesBase.plot</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">plot(md::MDLovoFitResult; 
    xlabel=[&quot;frame&quot;  &quot;residue&quot;], 
    ylabel=[&quot;RMSD / Å&quot; &quot;RMSF / Å&quot;], 
    yticks=[(0:1:maximum(md.rmsd_high),0:1:maximum(md.rmsd_high)) (0:1:maximum(md.rmsf),0:1:maximum(md.rmsf))], 
    ylims=[(0, maximum(md.rmsd_high)) (0, maximum(md.rmsf))], 
    stride=nothing, 
    kargs...
)</code></pre><p>Plot the results of a MDLovoFit calculation. The <code>stride</code> argument can be used to control the number of xtick residues plotted in the RMSF plot.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/09e9c088a0a17c575bd4eb61caeb847b89b2b82c/ext/MDLovoFit.jl#L35-L47">source</a></section></article><p>Continuing with the above example, now we will call the <code>mdlovofit</code> function, to obtain the best aligment of 80% of the atoms in each frame relative to the first frame:</p><pre><code class="language-julia hljs">md = mdlovofit(sim; fraction=0.8, output_name=&quot;mysim&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-------------------------------------------------------------------
MDLovoFitResult: Simulation(structure.pdb, trajectory.dcd)

-------------------------------------------------------------------

Aligned pdb file: mysim_aligned.pdb
RMSF data file: mysim_rmsf.dat
RMSD data file: mysim_rmsd.dat

Number of frames considered: 5
Average RMSD of all atoms: 2.01
Average RMSD of the 80.0% atoms of lowest RMSD: 1.13
Average RMSD of the 20.0% atoms of highest RMSD: 5.31

Frame indices availabe in field: frame_indices
RMSD data availabe in fields: rmsd_low, rmsd_high, and rmsd_all

RMSF data availabe in field: rmsf (Number of atoms: 43)
-------------------------------------------------------------------</code></pre><p>We now see that we can, in average, align 80% of the atoms in all frames to 1.13Å.  The output RMSD and RMSF data is available in the <code>md</code> data structure, and additionally three files were generated, containing:</p><ol><li><code>mysim_aligned.pdb</code>: a sequence of PDB files of the aligned trajectory.</li><li><code>mysim_rmsd.dat</code>: the RMSD data for low, high, and all atoms.</li><li><code>mysim_rmsf.dat</code>: the RMSF data for the atoms, resulting from the robust alignment.</li></ol><p>We can plot an overview of the results with:</p><pre><code class="language-julia hljs">plot(md)</code></pre><img src="da4a8b2d.svg" alt="Example block output"/><p>And we can see that, in this short (5-frame) trajectory, the N-terminal region of the  protein is the one responsible for the structural deviations, while there is a  rigid structural core between residues I221 and K249.</p><h3 id="mdlovofit3"><a class="docs-heading-anchor" href="#mdlovofit3">Step 3: Visualization of the aligned trajectory</a><a id="mdlovofit3-1"></a><a class="docs-heading-anchor-permalink" href="#mdlovofit3" title="Permalink"></a></h3><p>The PDB file created by <code>mdlovofit</code> contains the frames aligned to the reference frame, according to the robust alignment based on the least mobile substructure (determined by <code>fraction</code>). The file contains multiple models, separated by the <code>END</code> keyword.</p><p>The <code>occupancy</code> field of the atoms determines if the atom was used in the aligment, thus if it was found among the least mobile atoms of the simulation. The <code>beta</code> field contains the RMSF of the atom, in each frame. </p><p>Using, for example, <a href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a>, it is possible to display all frames at once, colored by <code>occupancy</code>, providing an overview of the mobility of the structure:</p><p><img src="../assets/mdlovofit.png" alt="mdlovofit.png"/></p><p>This structural superposition and the associated colors are correlatd with the  RMSF plot above. Red atoms were not used for the aligment and display high mobility, and blue atoms represent the stable core of the structure and were aligned.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../secondary_structures/">« Secondary structure</a><a class="docs-footer-nextpage" href="../block_averages/">Block averages »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 11 September 2025 00:12">Thursday 11 September 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body><div data-docstringscollapsed="true"></div></html>
