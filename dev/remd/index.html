<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Replica exchange · MolSimToolkit.jl</title><meta name="title" content="Replica exchange · MolSimToolkit.jl"/><meta property="og:title" content="Replica exchange · MolSimToolkit.jl"/><meta property="twitter:title" content="Replica exchange · MolSimToolkit.jl"/><meta name="description" content="Documentation for MolSimToolkit.jl."/><meta property="og:description" content="Documentation for MolSimToolkit.jl."/><meta property="twitter:description" content="Documentation for MolSimToolkit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="MolSimToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MolSimToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Structural analyses</span><ul><li><a class="tocitem" href="../Structural_properties/">Distances and misc.</a></li><li><a class="tocitem" href="../Dihedrals/">Dihedral angle analysis</a></li><li><a class="tocitem" href="../secondary_structures/">Secondary structure</a></li><li><a class="tocitem" href="../structural_alignment/">Structural alignment</a></li></ul></li><li><span class="tocitem">Simulation statistics</span><ul><li><a class="tocitem" href="../block_averages/">Block averages</a></li><li class="is-active"><a class="tocitem" href>Replica exchange</a><ul class="internal"><li><a class="tocitem" href="#Reading-REMD-data"><span>Reading REMD data</span></a></li><li><a class="tocitem" href="#Probability-heatmap"><span>Probability heatmap</span></a></li><li><a class="tocitem" href="#Replica-path"><span>Replica path</span></a></li><li><a class="tocitem" href="#Probability-data"><span>Probability data</span></a></li><li><a class="tocitem" href="#Reference-functions"><span>Reference functions</span></a></li></ul></li></ul></li><li><span class="tocitem">Interactions</span><ul><li><a class="tocitem" href="../Solvation_and_interactions/">Coordination numbers</a></li><li><a class="tocitem" href="../molecular_minimum_distances/">Molecular Minimum Distances</a></li></ul></li><li><span class="tocitem">Time-dependent properties</span><ul><li><a class="tocitem" href="../intermittent_correlation/">Intermittent correlation</a></li></ul></li><li><a class="tocitem" href="../system_setup/">System setup</a></li><li><a class="tocitem" href="../plotting_style/">Plotting style</a></li><li><a class="tocitem" href="../Developer/">Developer zone</a></li><li><span class="tocitem">Experimental</span><ul><li><a class="tocitem" href="../Reweighting/">Simulation Reweighting</a></li><li><a class="tocitem" href="../Coaraci/">Cluster submission management</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Simulation statistics</a></li><li class="is-active"><a href>Replica exchange</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Replica exchange</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/m3g/MolSimToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/m3g/MolSimToolkit.jl/blob/main/docs/src/remd.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Replica-exchange-analysis"><a class="docs-heading-anchor" href="#Replica-exchange-analysis">Replica exchange analysis</a><a id="Replica-exchange-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Replica-exchange-analysis" title="Permalink"></a></h1><p>The <code>remd_data</code> function reads the output of a Gromacs-generated  replica-exchange simulation file, and provides some tools for visualization of the quality of the exchange process.</p><div class="admonition is-compat" id="Compat-fa075d3d58ac97ec"><header class="admonition-header">Compat<a class="admonition-anchor" href="#Compat-fa075d3d58ac97ec" title="Permalink"></a></header><div class="admonition-body"><p>This function was introduced in <code>MolSimToolkit</code> version 1.1.0. </p><p>The function was tested to read log files produced by Gromacs versions: </p><ul><li>2019.4</li><li>5.0.4</li></ul><p>Compatibility with other versions is not guaranteed (issue reporting and contributions are welcome). </p><p>The <code>heatmap</code> and the support for the <code>stride</code> argument in <code>remd_replica_path</code> where introduced in version 1.6.0</p></div></div><h2 id="Reading-REMD-data"><a class="docs-heading-anchor" href="#Reading-REMD-data">Reading REMD data</a><a id="Reading-REMD-data-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-REMD-data" title="Permalink"></a></h2><p>First, read the data from the Gromacs simulation log file:</p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit

julia&gt; data = remd_data(&quot;gromacs.log&quot;)</code></pre><p>where &quot;gromacs.log&quot; would be a <code>log</code> file produced by Gromacs.</p><p>This will result in a data structure with three fields:</p><ul><li><code>steps</code>: Vector of steps at which the exchange was performed.</li><li><code>exchange_matrix</code>: Matrix of exchanges performed.  Each row corresponds to a step and each column to a replica. </li><li><code>probability_matrix</code>: Matrix of probabilities of finding each replica at level of  perturbation. Each column corresponds to a replica and each row to a level of perturbation.</li></ul><h2 id="Probability-heatmap"><a class="docs-heading-anchor" href="#Probability-heatmap">Probability heatmap</a><a id="Probability-heatmap-1"></a><a class="docs-heading-anchor-permalink" href="#Probability-heatmap" title="Permalink"></a></h2><p>One way to visualize the exchange it to produce a heatmap of expected probabilities. This can be done with the auxiliary <code>heatmap</code> function that is provided for the output of <code>remd_data</code>: </p><pre><code class="language-julia hljs">using MolSimToolkit
using Plots
data = remd_data(MolSimToolkit.gmx5_0_4_log)
heatmap(data)</code></pre><img src="0d12785d.svg" alt="Example block output"/><p>The number of replicas here is 16 (0-15), thus the expected ideal probability of finding each replica in each level is <span>$1/16$</span>. The probabilities are divided by <span>$1/16$</span>, such that <span>$1.0$</span> implies  an optimal exchange at that replica and level. </p><p>To produce a similar heatmap, but with the absolute (not normalized) probabilities of  observing each replica at each level, use <code>heatmap(data; probability_type=:absolute)</code>. </p><p>In the above example, replica 1 got trapped in the first 5 levels,  while a block is noticeable for replicas 10-12, which display high  probabilities to be found at levels 13 to 15. Thus, this is an example of a inadequate exchange between the levels.</p><div class="admonition is-compat" id="Compat-38752b1714a3481f"><header class="admonition-header">Compat<a class="admonition-anchor" href="#Compat-38752b1714a3481f" title="Permalink"></a></header><div class="admonition-body"><p>The <code>probability_type</code> option of <code>heatmap</code> was introduced in version 1.7.0.</p></div></div><h2 id="Replica-path"><a class="docs-heading-anchor" href="#Replica-path">Replica path</a><a id="Replica-path-1"></a><a class="docs-heading-anchor-permalink" href="#Replica-path" title="Permalink"></a></h2><p>A heatmap as the one above suggests checking the path of the replicas along the exchange.  This can be obtained with the <code>remd_replica_path</code> function. For example, to obtain the path of the replicas of number 0 and 1. Replica 0 appeares to have visited reasonably well  all levels from 0 to 12, and replica 1 appears to be trapped in leves 13 to 15.</p><pre><code class="language-julia hljs">using MolSimToolkit
using Plots
data = remd_data(MolSimToolkit.gmx5_0_4_log)

# Obtain the paths
path0 = remd_replica_path(data, 0; stride = 1)
path10 = remd_replica_path(data, 10; stride = 1)

# Plot the path
plt = plot(MolSimStyle, xlabel=&quot;step&quot;, ylabel=&quot;replica level&quot;)
plot!(plt, path0, label=&quot;replica 0&quot;, linewidth=2)
plot!(plt, path10, label=&quot;replica 10&quot;, linewidth=2)</code></pre><img src="9d321e6a.svg" alt="Example block output"/><p>The plot confirms that the replica starting at position 0 sampled preferentially the  first 5 states, while replica 10 was trapped temporarily in the high level states, in this sample run.</p><h2 id="Probability-data"><a class="docs-heading-anchor" href="#Probability-data">Probability data</a><a id="Probability-data-1"></a><a class="docs-heading-anchor-permalink" href="#Probability-data" title="Permalink"></a></h2><p>An alternative visualization of the exchange process is given by the probability matrix:</p><pre><code class="language-julia hljs">using MolSimToolkit
using Plots
data = remd_data(MolSimToolkit.gmx5_0_4_log)
scatter(MolSimStyle,
    data.probability_matrix,
    labels= Ref(&quot;Replica &quot;) .* string.((0:15)&#39;),
    linewidth=2,
    ylims=(0,0.12), xlims=(0.7, 16.3),
    xlabel=&quot;Level&quot;, xticks=(1:16, 0:15),
    ylabel=&quot;Probability&quot;,
    alpha=0.5,
    margin=0.5Plots.Measures.cm,
    legend=:outertopright,
)</code></pre><img src="f2b7471e.svg" alt="Example block output"/><p>Ideally, the probability of each replica populaing each level should be the inverse of the number of replicas (here <span>$1/16 == 0.0625$</span>). In this case, the simulation does not provide a proper sampling of exchanges, as it is a short extract of a longer simulation. </p><h2 id="Reference-functions"><a class="docs-heading-anchor" href="#Reference-functions">Reference functions</a><a id="Reference-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.remd_data-Tuple{String}" href="#MolSimToolkit.remd_data-Tuple{String}"><code>MolSimToolkit.remd_data</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">remd_data(log::String)</code></pre><p>Function to read the log file from a (H)REMD simulation performed with Gromacs.</p><p>Returns a <code>GromacsREMDlog</code> structure, containing the steps at which the exchange was tried, the exchange matrix and the probability matrix. The exchange matrix contains the replica number at each level of perturbation for each step. The probability matrix contains the probability of finding each replica at each level.</p><p>Tested with log files of Gromacs versions:      - 2019.4     - 5.0.4</p><p><strong>Example</strong></p><p>First obtaina the REMD data from the log file:</p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit

julia&gt; data = remd_data(MolSimToolkit.gmx2019_9_log)</code></pre><p>Then plot the exchange matrix, which will provide a visual inspection of the exchange process:</p><pre><code class="language-julia-repl hljs">julia&gt; using Plots

julia&gt; heatmap(data) </code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/b645077559a0df9d8650e5fffff5d45e88f6a821/src/gromacs/remd.jl#L26-L57">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.remd_replica_path-Tuple{MolSimToolkit.GromacsREMDlog, Integer}" href="#MolSimToolkit.remd_replica_path-Tuple{MolSimToolkit.GromacsREMDlog, Integer}"><code>MolSimToolkit.remd_replica_path</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">remd_replica_path(data::GromacsREMDlog, replica::Integer; stride::Integer = 1)</code></pre><p>Function to obtain the path of a replica in the exchange matrix.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/b645077559a0df9d8650e5fffff5d45e88f6a821/src/gromacs/remd.jl#L106-L111">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MolSimToolkit.GromacsREMDlog" href="#MolSimToolkit.GromacsREMDlog"><code>MolSimToolkit.GromacsREMDlog</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">GromacsRMEDlog</code></pre><p>Structure to store the log from a REMD simulation performed with Gromacs.  This structure contains three fields:</p><ul><li><code>steps</code>: Vector of steps at which the exchange was performed.</li><li><code>exchange_matrix</code>: Matrix of exchanges performed.  Each row corresponds to a step and each column to a replica. </li><li><code>probability_matrix</code>: Matrix of probabilities of finding each replica at level of  perturbation. Each column corresponds to a replica and each row to a level of perturbation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/b645077559a0df9d8650e5fffff5d45e88f6a821/src/gromacs/remd.jl#L4-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Plots.heatmap-Tuple{MolSimToolkit.GromacsREMDlog}" href="#Plots.heatmap-Tuple{MolSimToolkit.GromacsREMDlog}"><code>Plots.heatmap</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">heatmap(data::GromacsREMDlog;
    xlabel=&quot;replica&quot;,
    ylabel=&quot;initial replica level&quot;,
    fontfamily=&quot;Computer Modern&quot;,
    probability_type::Symbol=:relative,
    kargs...
)</code></pre><p>Function to plot the probability matrix of a (H)REMD simulation. The probability matrix contains the probability of finding each replica at each level of perturbation.</p><p>Use <code>probability_type=:relative</code> to plot the probability matrix normalized by the number of replicas, or <code>probability_type=:absolute</code> to plot the probability matrix without normalization.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using MolSimToolkit, Plots

julia&gt; data = remd_data(MolSimToolkit.gmx2019_4_log)

julia&gt; heatmap(data)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/m3g/MolSimToolkit.jl/blob/b645077559a0df9d8650e5fffff5d45e88f6a821/ext/REMD.jl#L4-L29">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../block_averages/">« Block averages</a><a class="docs-footer-nextpage" href="../Solvation_and_interactions/">Coordination numbers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Friday 6 June 2025 22:37">Friday 6 June 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body><div data-docstringscollapsed="true"></div></html>
